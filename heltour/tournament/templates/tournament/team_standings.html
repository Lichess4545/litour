{% extends "base.html" %}
{% load static tournament_extras %}
{% block title %}Standings - {{ season.name }} - {{ league.name }}{% endblock %}
{% block nav_standings %}active{% endblock %}
{% block css %}
<style>
.cell-bye {
    background-color: #f9f9f9 !important;
    border: 1px solid #e0e0e0 !important;
}
</style>
{% endblock %}
{% block content %}
    <div class="row row-condensed-xs">
        <div class="col-md-12">
            <div class="well">
                <div class="well-head">
                    <h3>
                        {% if season.is_completed %}Final{% endif %}
                        Standings
                    </h3>
                </div>
                <div class="well-body">
                    {% if team_scores %}
                        <div class="table-responsive sortable">
                            <table class="table table-striped table-condensed-sm sortable">
                                <thead>
                                    <tr>
                                        <th class="sort asc"></th>
                                        <th class="sort">Team</th>
                                        {% if not zen_mode %}<th class="text-center hidden-sm hidden-xs sort">Average Rating</th>{% endif %}
                                        <th class="text-center sort">
                                            <span class="visible-sm visible-xs">Match Pts</span>
                                            <span class="hidden-sm hidden-xs">Match Points</span>
                                        </th>
                                        {% for tb_name, tb_display in tiebreaks %}
                                        <th class="text-center sort">
                                            <span class="visible-sm visible-xs">{{ tb_display|truncatechars:8 }}</span>
                                            <span class="hidden-sm hidden-xs">{{ tb_display }} (Tbk {{ forloop.counter }})</span>
                                        </th>
                                        {% endfor %}
                                        {% for round_number in round_numbers %}<th class="text-center sort">Round {{ round_number }}</th>{% endfor %}
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for number, team_score in team_scores %}
                                        <tr>
                                            <td class="text-center cell-teamnumber">{{ number }}</td>
                                            <td>
                                                <a class="team-link"
                                                   href="{% leagueurl 'team_profile' league.tag season.tag team_score.team.number %}">{{ team_score.team.name }}</a>
                                            </td>
                                            {% if not zen_mode %}
                                                <td class="text-center hidden-sm hidden-xs">{{ team_score.team.average_rating|floatformat:2 }}</td>
                                            {% endif %}
                                            <td class="text-center">{{ team_score.match_points_display }}</td>
                                            {% for tb_name, tb_display in tiebreaks %}
                                            <td class="text-center">
                                                {% if tb_name == 'game_points' %}{{ team_score.game_points_display }}
                                                {% elif tb_name == 'head_to_head' %}{{ team_score.head_to_head_display }}
                                                {% elif tb_name == 'games_won' %}{{ team_score.games_won_display }}
                                                {% elif tb_name == 'sonneborn_berger' %}{{ team_score.sb_score_display }}
                                                {% elif tb_name == 'eggsb' %}{{ team_score.sb_score_display }}
                                                {% elif tb_name == 'emmsb' %}{{ team_score.sb_score_display }}
                                                {% elif tb_name == 'emgsb' %}{{ team_score.sb_score_display }}
                                                {% elif tb_name == 'egmsb' %}{{ team_score.sb_score_display }}
                                                {% elif tb_name == 'buchholz' %}{{ team_score.buchholz_display }}
                                                {% endif %}
                                            </td>
                                            {% endfor %}
                                            {% for round_score_data in team_score.round_scores %}
                                                {% if round_score_data|length == 4 %}
                                                    {% with round_score_data as score_opp_round_bye %}
                                                        <td class="text-center cell-score {% if score_opp_round_bye.3 %}cell-bye{% else %}{% resultclass score_opp_round_bye.0 score_opp_round_bye.1 %}{% endif %}">
                                                            {% if score_opp_round_bye.0 != None %}
                                                                {% if score_opp_round_bye.3 %}
                                                                    <span style="font-style: italic; color: #888;">BYE</span>
                                                                {% else %}
                                                                    <a href="{% leagueurl 'pairings_by_round_team' league.tag season.tag score_opp_round_bye.2 team_score.team.number %}">{{ score_opp_round_bye.0|floatformat }}</a>
                                                                {% endif %}
                                                            {% endif %}
                                                        </td>
                                                    {% endwith %}
                                                {% else %}
                                                    {% with round_score_data as score_opp_round %}
                                                        <td class="text-center cell-score {% resultclass score_opp_round.0 score_opp_round.1 %}">
                                                            {% if score_opp_round.0 != None %}
                                                                <a href="{% leagueurl 'pairings_by_round_team' league.tag season.tag score_opp_round.2 team_score.team.number %}">{{ score_opp_round.0|floatformat }}</a>
                                                            {% endif %}
                                                        </td>
                                                    {% endwith %}
                                                {% endif %}
                                            {% endfor %}
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="row">
                            <div class="col-md-12">No standings available.</div>
                        </div>
                    {% endif %}
                </div>
                <div class="well-head">
                    <h3>Legend</h3>
                </div>
                <div class="well-body">
                    <table class="table table-condensed-sm">
                        <tbody>
                            <tr>
                                <td class="text-center cell-score cell-win">4</td>
                                <td>Win with 4 game points</td>
                            </tr>
                            <tr>
                                <td class="text-center cell-score cell-loss">1.5</td>
                                <td>Loss with 1.5 points</td>
                            </tr>
                            <tr>
                                <td class="text-center cell-score cell-tie">2</td>
                                <td>Draw with 2 points</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="{% static 'lib/js/sort-tables.js' %}"></script>
{% endblock %}
